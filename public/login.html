<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Log in </title>
</head>
<body>
<h1>Log in</h1>

<form id="loginForm">
  <label>Email
    <input name="email" type="email" required>
  </label>
  <br><br>
  <label>password
    <input name="password" type="password" required>
  </label>
  <br><br>
  <button type="submit">Sign in</button>

  <p id="err" style="color:red"></p>
</form>

<script>
  // Если уже вошёл — перенаправляем
  fetch("/api/auth/me")
    .then(r => r.json())
    .then(d => { if (d.user) location.href="/home.html"; });

  document.getElementById("loginForm").onsubmit = async (e) => {
    e.preventDefault();
    const body = new URLSearchParams(new FormData(e.target));

    const r = await fetch("/api/auth/login", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body
    });

    if (r.ok) {
      location.href="/home.html";
    } else {
      document.getElementById("err").textContent = "Неверный логин или пароль";
    }
  };
</script>
</body>
</html>
